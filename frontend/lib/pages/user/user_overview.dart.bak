import "package:flutter/material.dart";
import 'package:easy_sidemenu/easy_sidemenu.dart';
import 'package:gui/models/user_model.dart';
import 'package:gui/pages/user/add_sid_view.dart';
import 'package:gui/pages/user/notifications_view.dart';
import 'package:gui/pages/user/overview_view.dart';
import 'package:gui/pages/user/profile_view.dart';
import 'package:gui/pages/user/settings_view.dart';
import 'package:gui/pages/user/sid_view.dart';

class UserOverviewPage extends StatefulWidget {
  const UserOverviewPage({Key? key, required this.user}) : super(key: key);
  final DewsUser user;

  @override
  State<UserOverviewPage> createState() => _UserOverviewPageState();
}

class _UserOverviewPageState extends State<UserOverviewPage> {
  PageController pageController = PageController();
  SideMenuController sideMenuController = SideMenuController();
  bool openDisplayMode = true;

  @override
  void initState() {
    sideMenuController.addListener((index) {
      pageController.jumpToPage(index);
    });
    super.initState();
  }

  @override
  Widget build(BuildContext context) {
    List<SideMenuItem> sideMenuItems = [
      // Divider
      SideMenuItem(
        builder: (context, displayMode) {
          return const Divider(
            endIndent: 8,
            indent: 8,
          );
        },
      ),
      // Overview
      SideMenuItem(
        title: "Overview",
        onTap: (index, _) {
          sideMenuController.changePage(index);
        },
        icon: const Icon(Icons.home),
        tooltipContent: "Brings you to the overview page.",
      ),
      // Satellite Image Data
      SideMenuItem(
        title: "Satellite Image Data",
        onTap: (index, _) {
          sideMenuController.changePage(index);
          setState(() {
            widget.user.newFilesCount = 0;
          });
        },
        icon: const Icon(Icons.satellite_alt),
        badgeContent: widget.user.newFilesCount >= 1
            ? Text(
                "${widget.user.newFilesCount}",
                style: const TextStyle(fontSize: 10, color: Colors.white),
              )
            : null,
      ),
      // Notifications
      SideMenuItem(
        title: "Notifications",
        onTap: (index, _) {
          sideMenuController.changePage(index);
          setState(() {
            widget.user.notificationsCount = 0;
          });
        },
        icon: const Icon(Icons.notifications),
        badgeContent: widget.user.notificationsCount >= 1
            ? Text(
                "${widget.user.notificationsCount}",
                style: const TextStyle(fontSize: 10, color: Colors.white),
              )
            : null,
        tooltipContent: "Shows you all your recent notifications.",
      ),
      // Divider
      SideMenuItem(
        builder: (context, displayMode) {
          return const Divider(
            endIndent: 8,
            indent: 8,
          );
        },
      ),
      // Profile
      SideMenuItem(
        title: "Profile",
        onTap: (index, _) {
          sideMenuController.changePage(index);
        },
        icon: const Icon(Icons.supervisor_account),
      ),
      // Settings
      SideMenuItem(
        title: "Settings",
        onTap: (index, _) {
          sideMenuController.changePage(index);
        },
        icon: const Icon(Icons.settings),
      ),
      // Help
      SideMenuItem(
        title: "Help",
        onTap: (index, _) {
          sideMenuController.changePage(index);
        },
        icon: const Icon(Icons.help),
      ),
      // Contact
      SideMenuItem(
        title: "Contact",
        onTap: (index, _) {
          sideMenuController.changePage(index);
        },
        icon: const Icon(Icons.mail),
      ),
      // Logout
      SideMenuItem(
        title: "Logout",
        onTap: (index, _) {
          sideMenuController.changePage(index);
        },
        icon: const Icon(Icons.logout),
      ),
    ];

    return Scaffold(
      appBar: AppBar(
        title: const Row(
          mainAxisAlignment: MainAxisAlignment.center,
          children: [
            Icon(
              Icons.satellite_outlined,
              size: 30,
              color: Colors.white,
            ),
            SizedBox(
              width: 5,
            ),
            Text(
              "Drought EWS's Datahub",
              style: TextStyle(fontSize: 25),
            )
          ],
        ),
        centerTitle: true,
      ),
      body: Row(
        mainAxisAlignment: MainAxisAlignment.start,
        children: [
          SideMenu(
            title: Row(
              mainAxisAlignment: MainAxisAlignment.center,
              children: [
                GestureDetector(
                  onTap: () {
                    setState(() {
                      openDisplayMode = !openDisplayMode;
                    });
                  },
                  child: openDisplayMode
                      ? collapseArrow(Icons.arrow_back, 280)
                      : collapseArrow(Icons.arrow_forward, 30),
                )
              ],
            ),
            controller: sideMenuController,
            style: SideMenuStyle(
              showTooltip: false,
              displayMode: openDisplayMode
                  ? SideMenuDisplayMode.open
                  : SideMenuDisplayMode.compact,
              hoverColor: Colors.blue[100],
              selectedHoverColor: Colors.blue[100],
              selectedColor: Colors.lightBlue,
              selectedTitleTextStyle: const TextStyle(color: Colors.white),
              selectedIconColor: Colors.white,
              // decoration: BoxDecoration(
              //   borderRadius: BorderRadius.all(Radius.circular(10)),
              // ),
              // backgroundColor: Colors.blueGrey[700]
            ),
            footer: Padding(
              padding: const EdgeInsets.all(8.0),
              child: Container(
                decoration: BoxDecoration(
                    color: Colors.lightBlue[100],
                    borderRadius: BorderRadius.circular(12)),
                child: const Padding(
                  padding: EdgeInsets.symmetric(vertical: 4, horizontal: 10),
                  child: Row(
                    mainAxisAlignment: MainAxisAlignment.center,
                    children: [
                      Icon(
                        Icons.copyright,
                        size: 15,
                      ),
                      SizedBox(
                        width: 5,
                      ),
                      Text(
                        "Minh Justin Tráº§n",
                        style: TextStyle(
                            fontSize: 15,
                            color: Color.fromARGB(255, 100, 100, 100)),
                      ),
                    ],
                  ),
                ),
              ),
            ),
            items: sideMenuItems,
          ),
          Expanded(
            child: PageView(
              controller: pageController,
              children: [
                // Side menu pages
                DashboardPage(user: widget.user), // divider workaround
                DashboardPage(user: widget.user), 
                SatelliteImageDataPage(user: widget.user, pageController: pageController),
                NotificationsPage(user: widget.user),
                ProfilePage(user: widget.user), // divider workaround
                ProfilePage(user: widget.user),
                SettingsPage(user: widget.user),
                Container(
                  color: Colors.white,
                  child: const Center(
                    child: Text(
                      'Help',
                      style: TextStyle(fontSize: 25),
                    ),
                  ),
                ),
                Container(
                  color: Colors.white,
                  child: const Center(
                    child: Text(
                      'Contact',
                      style: TextStyle(fontSize: 25),
                    ),
                  ),
                ),
                Container(
                  color: Colors.white,
                  child: const Center(
                    child: Text(
                      'Logout',
                      style: TextStyle(fontSize: 25),
                    ),
                  ),
                ),
                // Other pages
                AddSidPage(user: widget.user, pageController: pageController),

              ],
            ),
          ),
        ],
      ),
    );
  }

  Container collapseArrow(IconData iconData, double width) {
    return Container(
      margin: const EdgeInsets.all(10),
      width: width,
      alignment: Alignment.center,
      decoration: BoxDecoration(
        color: Colors.lightBlue[100],
        borderRadius: BorderRadius.circular(5),
      ),
      child: Icon(
        iconData,
        size: 30,
        color: Colors.black54,
      ),
    );
  }
}
